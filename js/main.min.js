var flag = false;
$('.poll').on('init', function (event, slick) {
    slick.$nextArrow.parent().hide();
    $('.poll-nav__dislike').parent().hide();
    $('.poll-nav__submit').parent().hide();
    if ($('.poll').find('.slick-current').hasClass('next-b') && $('.poll').find('.slick-current').data('slick-index') === slick.currentSlide) {
        slick.$nextArrow.parent().show();
    }
});

$('.poll').slick({
    arrows: true,
    autoplay: false,
    prevArrow: $('.poll-nav .poll-nav__prev'),
    nextArrow: $('.poll-nav .poll-nav__next'),
    fade: true,
    slidesToShow: 1,
    slidesToScroll: 1,
    focusOnSelect: false,
    focusOnChange: false,
    infinite: false,
    swipe: false,
    adaptiveHeight: true,
    draggable: false
});

$('.poll').on('beforeChange', function () {
  document.getElementsByClassName('container')[0].scrollIntoView({ block: 'end',  behavior: 'smooth' });
})

$('.poll').on('afterChange', function (event, slick, currentSlide, nextSlide) {
    $('#progressbar .ui-progressbar-value > span').text(Math.round((100 / slick.slideCount)) * slick.currentSlide + '%');
    $('#progressbar').progressbar('value', Math.round($('.poll').slick('slickCurrentSlide')));
    if ($('.poll').find('.slick-current').hasClass('next-b') && $('.poll').find('.slick-current').data('slick-index') === slick.currentSlide) {
        slick.$nextArrow.parent().show();
    }

    else {
        slick.$nextArrow.parent().hide()
    }

    if ($('.poll').find('.slick-current').hasClass('dislike-b') && $('.poll').find('.slick-current').data('slick-index') === slick.currentSlide) {
        $('.poll-nav__dislike').parent().show();
    }

    else {
        $('.poll-nav__dislike').parent().hide();
    }
});

var shop = '.shop-',
    shoping = '.shop-nav-',
    prev =  '.shop-nav__prev',
    next = '.shop-nav__next',
    dots = 'shop-dots shop-dots-',
    prod = '.products-slider-',
    pdots = 'products-dots products-dots-';
/*
for (var i = 1; i < $('.shop').length + 1; i++) {
    $(shop + i).slick({
        arrows: true,
        autoplay: false,
        prevArrow: $(shoping + i + ' ' + prev),
        nextArrow: $(shoping + i + ' ' + next),
        fade: false,
        slidesToShow: 1,
        slidesToScroll: 1,
        focusOnChange: false,
        focusOnSelect: false,
        infinite: true,
        dots: true,
        dotsClass: dots + i
    });
}
*/

for (var q = 1; q < $('.products-slider').length + 1; q++) {
    $(prod + q).slick({
        arrows: false,
        autoplay: false,
        fade: false,
        slidesToScroll: 1,
        slidesToShow: 1,
        focusOnChange: false,
        focusOnSelect: false,
        infinite: true,
        dots: true,
        dotsClass: pdots + q
    });
}

$('.discounts').slick({
    arrows: false,
    autoplay: true,
    fade: false,
    slidesToScroll: 1,
    slidesToShow: 1,
    focusOnChange: false,
    focusOnSelect: false,
    infinite: true,
    dots: true,
    dotsClass: 'discounts-dots'
});

$( function() {
    $( "#slider-range" ).slider({
        range: true,
        min: 99,
        max: 2600,
        values: [ 150, 2500 ],
        slide: function( event, ui ) {
            $('.ui-slider-handle:first-of-type > i').text(function () {
                return '£' + ui.values[ 0 ];
            });
            $('.ui-slider-handle:last-of-type > i').text(function () {
                return '£' + ui.values[ 1 ];
            });
        }
    });
    $( "#amount-min" ).val( "£" + $( "#slider-range" ).slider('option', 'min'));
    $( "#amount-max" ).val( "£" + $( "#slider-range" ).slider('option', 'max'));
    $('.ui-slider-handle:first-of-type').append('<i>' + '£' + $('#slider-range').slider('values', 0) + '</i>');
    $('.ui-slider-handle:last-of-type').append('<i>' + '£' + $('#slider-range').slider('values', 1) + '</i>');
});

$( function() {
    $( "#progressbar" ).progressbar({
        max: $('.poll-item').length,
        value: $('.poll').slideCount
    });
    $('#progressbar .ui-progressbar-value').append('<span>' + $('#progressbar').progressbar('value') + '%' + '</span>');
});

$( function () {
   $('.masonry').masonry({
       itemSelector: '.masonry-item',
       columnWidth: '.masonry-item',
       percentPosition: true,
       horizontalOrder: true,
   });
});

$('.masonry-item__photo').on('click', function (e) {
   $(this).toggleClass('checked');
   e.preventDefault();
});

$('.masonry-item__full').on('click', function (e) {
    $(this).toggleClass('checked');
    e.preventDefault();
});

$('.card-item > a').on('click', function (e) {
   $(this).addClass('choice');
   if (!$(this).closest('.poll-item').hasClass('next-b')) {
     $('.poll').slick('slickNext');
   }
   if ($(this).find('span[class*="glyph-"]').length && $(this).find('p[class="card-item__name"]').length) {
       sclass = $(this).find('span[class*="glyph-"]').attr('class');
       ptext = $(this).find('p[class="card-item__name"]').text();
       $('.picked').append('' +
           '<li class="picked-item">' +
           '<span class=""></span>' +
           '<p>Fairly big</p>' +
           '<i class="glyph-pencil"></i>' +
           '</li>');
       $('.picked').children('.picked-item:last-of-type').find('span').addClass(sclass);
       $('.picked').children('.picked-item:last-of-type').find('p').text(ptext);
   }
   e.preventDefault();
});

$('.poll-nav__skip').on('click', function () {
   $('.poll').slick('slickNext');
});

$('.poll-nav__submit').on('click', function () {
    $('.specifications').removeClass('start');
});

$('.helper-text__info > span').on('click', function () {
    if ($('.helper-text__info > p').css('display') !== 'block') {
        $('.helper-text__info > p').fadeIn();
    }
    else {
        $('.helper-text__info > p').fadeOut();
    }
    $(this).toggleClass('opened');
});

$('.visual-buttons__item > a').on('click', function (e) {
    if (!$(this).hasClass('active')) {
        $('.visual-buttons__item > a').removeClass('active');
        $(this).addClass('active');
    }
    e.preventDefault();
});

$('.marker-list__item').on('click', function () {
   $(this).toggleClass('change');
});
$('.floor-form > input').on('change', function () {
    $(this).closest('.card').addClass('choice');
    $(this).closest('.card').prepend('' +
        '<li class="col-lg-12 card-item">' +
        '<div class="card-item__upload">' +
        '<div class="progress-label poll-item__status">' +
        'Loading...' +
        '</div>' +
        '</div>' +
        '</li>'
    );
    $(this).closest('.card').siblings('.poll-item__description').css('margin-bottom', '13px');

    $('.card-item__upload').progressbar({
        value: false,
        change: function() {
            $('.progress-label').text( $('.card-item__upload').progressbar( "value" ) + "%" );
        },
        complete: function() {
            $('.progress-label').text( "Complete!" );
            $('.poll-nav__submit').parent().show();
        }
    });

    setTimeout( progress, 2000 );
});

function progress() {
    var val = $('.card-item__upload').progressbar( "value" ) || 0;

    $('.card-item__upload').progressbar( "value", val + 2 );

    if ( val < 99 ) {
        setTimeout( progress, 80 );
    }
}
