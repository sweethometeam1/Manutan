const solution = {
  'id': '520',
  'outline': [],
  'data': {
    'furniture_cad': [],
    'furniture_info': [
      {
        'name': 'armchair1',
        'image': '/img/demo/2737188194628930003.png',
        'id': '1',
        'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/bodilaccentchairgreyleather',
        'assetName': 'Assets/Office/Prefabs/Armchairs/BodilAccentChairGreyLeather.prefab',
        'info': ['Manutan', 'Leather Armchair'],
        'price': 1800,
        type: 'Armchairs (1)'
      },
      {
        'name': 'armchair2',
        'image': '/img/demo/2737188194628930003.png',
        'id': '2',
        'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/bodilaccentchairgreyleather',
        'assetName': 'Assets/Office/Prefabs/Armchairs/BodilAccentChairGreyLeather.prefab',
        'info': ['Manutan', 'Leather Armchair'],
        'price': 1800,
        type: 'Armchairs (2)'
      },
      {
        'name': 'sofa1',
        'image': '/img/demo/sofa-gray.png',
        'id': '3',
        'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/empressupholsteredsofaazuregrey',
        'assetName': 'Assets/Office/Prefabs/Sofas/EmpressUpholsteredSofaAzureGrey.prefab',
        'info': ['Manutan', 'Upholstered Sofa'],
        'price': 5200,
        type: 'Sofas (1)'
      }
    ],
    'alternatives': {
      'armchair1': [
        {
          'name': 'armchair1',
          'image': '/img/demo/2737188194628930003.png',
          'id': '1',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/bodilaccentchairgreyleather',
          'assetName': 'Assets/Office/Prefabs/Armchairs/BodilAccentChairGreyLeather.prefab',
          'info': ['Manutan', 'Leather Armchair'],
          'price': 1800,
          type: 'Armchairs (1)'
        },
        {
          'name': 'armchair1',
          'image': '/img/demo/logo.png',
          'id': '22',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/milnerreclinerchair',
          'assetName': 'Assets/Office/Prefabs/Armchairs/MilnerReclinerChair.prefab',
          'info': ['Manutan', 'Recliner Chair'],
          'price': 2000,
          type: 'Armchairs (1)'
        },
        {
          'name': 'armchair1',
          'image': '/img/demo/2607245392596082096.png',
          'id': '23',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/nevadaarmchairantiquecognacleather',
          'assetName': 'Assets/Office/Prefabs/Armchairs/NevadaArmchairAntiqueCognacLeather.prefab',
          'info': ['Manutan', 'Leather Armchair'],
          'price': 2100,
          type: 'Armchairs (1)'
        },
        {
          'name': 'armchair1',
          'image': '/img/demo/armchair-gray.png',
          'id': '24',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/nevadaarmchairantiquewhiteleather',
          'assetName': 'Assets/Office/Prefabs/Armchairs/NevadaArmchairAntiqueWhiteLeather.prefab',
          'info': ['Manutan', 'Leather Armchair'],
          'price': 2100,
          type: 'Armchairs (1)'
        }
      ],
      'armchair2': [
        {
          'name': 'armchair2',
          'image': '/img/demo/2737188194628930003.png',
          'id': '2',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/bodilaccentchairgreyleather',
          'assetName': 'Assets/Office/Prefabs/Armchairs/BodilAccentChairGreyLeather.prefab',
          'info': ['Manutan', 'Leather Armchair'],
          'price': 1800,
          type: 'Armchairs (2)'
        },
        {
          'name': 'armchair2',
          'image': '/img/demo/logo.png',
          'id': '25',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/milnerreclinerchair',
          'assetName': 'Assets/Office/Prefabs/Armchairs/MilnerReclinerChair.prefab',
          'info': ['Manutan', 'Recliner Chair'],
          'price': 2000,
          type: 'Armchairs (2)'
        },
        {
          'name': 'armchair2',
          'image': '/img/demo/2607245392596082096.png',
          'id': '26',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/nevadaarmchairantiquecognacleather',
          'assetName': 'Assets/Office/Prefabs/Armchairs/NevadaArmchairAntiqueCognacLeather.prefab',
          'info': ['Manutan', 'Leather Armchair'],
          'price': 2100,
          type: 'Armchairs (2)'
        },
        {
          'name': 'armchair2',
          'image': '/img/demo/armchair-gray.png',
          'id': '27',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/nevadaarmchairantiquewhiteleather',
          'assetName': 'Assets/Office/Prefabs/Armchairs/NevadaArmchairAntiqueWhiteLeather.prefab',
          'info': ['Manutan', 'Leather Armchair'],
          'price': 2100,
          type: 'Armchairs (2)'
        }
      ],
      'sofa1': [
        {
          'name': 'sofa1',
          'image': '/img/demo/sofa-gray.png',
          'id': '3',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/empressupholsteredsofaazuregrey',
          'assetName': 'Assets/Office/Prefabs/Sofas/EmpressUpholsteredSofaAzureGrey.prefab',
          'info': ['Manutan', 'Upholstered Sofa'],
          'price': 5200,
          type: 'Sofas (1)'
        },
        {
          'name': 'sofa1',
          'image': '/img/demo/7026071325126691907.png',
          'id': '28',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/edsonlargebenchcementmetal',
          'assetName': 'Assets/Office/Prefabs/Sofas/EdsonLargeBenchCementMetal.prefab',
          'info': ['Manutan', 'Large Bench'],
          'price': 4300,
          type: 'Sofas (1)'
        },
        {
          'name': 'sofa1',
          'image': '/img/demo/7107643015305196964.png',
          'id': '29',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/empressupholsteredsofaazuremodway',
          'assetName': 'Assets/Office/Prefabs/Sofas/EmpressUpholsteredSofaAzureModway.prefab',
          'info': ['Manutan', 'Upholstered Sofa'],
          'price': 5200,
          type: 'Sofas (1)'
        },
        {
          'name': 'sofa1',
          'image': '/img/demo/sofa-pink.png',
          'id': '30',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/empressupholsteredsofaazurepink',
          'assetName': 'Assets/Office/Prefabs/Sofas/EmpressUpholsteredSofaAzurePink.prefab',
          'info': ['Manutan', 'Upholstered Sofa'],
          'price': 5200,
          type: 'Sofas (1)'
        },
        {
          'name': 'sofa1',
          'image': '/img/demo/4592270869599153959.png',
          'id': '30',
          'assetUrl': 'https://dkbsj3nir6mzw.cloudfront.net/models/office-demo/ohiosofabed',
          'assetName': 'Assets/Office/Prefabs/Sofas/OhioSofaBed.prefab',
          'info': ['Manutan', 'Sofa Bed'],
          'price': 5000,
          type: 'Sofas (1)'
        },
      ]
    }
  }
};

const otherFurniture = [
  {
    image: 'img/demo/1443387840997430117.png',
    'info': ['Manutan', 'Desk Lamp'],
    'price': 250,
  },
  {
    image: 'img/demo/2256386779305582850.png',
    'info': ['Manutan', 'Dining Chair'],
    'price': 980,
  },
  {
    image: 'img/demo/4779817995753522450.png',
    'info': ['Manutan', 'Leather Chrome Dinning Chair'],
    'price': 1100,
  },
  {
    image: 'img/demo/7909488656504713554.png',
    'info': ['Manutan', 'Game Armchair'],
    'price': 4900,
  },
  {
    image: 'img/demo/8715809213973178913.png',
    'info': ['Manutan', 'Extending Dining Table 140cm'],
    'price': 5900,
  }
]

let unityInstance = null;
let loadedItemsCount = 0;
let infoPopupData = null;

window.loadUnitySetup = () => {
  $('.imagination-list').css({ height: $('.webgl-content').css('height') });
  solution.data.furniture_info.map(f =>
    unityInstance.SendMessage(
      f.type,
      'Load',
      f.assetUrl + '|' + f.assetName + '|' + f.id + '|true'
    )
  );
};
window.unityItemLoaded = () => {
  $('.webgl-content').css({ filter: 'blur(0px)' })
  loadedItemsCount++;
  if (loadedItemsCount === solution.data.furniture_info.length) {
    $('.loading').removeClass('waiting');
    $('.imagination').addClass('start');
    // loadAllModels();
  }
};
window.openPopup = (x, y, id) => {
  infoPopupData = {
    x,
    y,
    item: solution.data.furniture_info.find(f => f.id === id)
  };
}
window.addEventListener('keydown', (event) => {
  infoPopupData = null;
});
window.addEventListener('mousedown', (event) => {
  infoPopupData = null;
});
window.addEventListener('mousewheel', (event) => {
  infoPopupData = null;
});

$(document).on('click', '.poll-nav__submit', (e) => {
    unityInstance = UnityLoader.instantiate(
      'unityContainer',
      '/scenes/office/Build/office.json',
    );

    $('.loading').addClass('waiting');
    e.preventDefault();
})

$(document).on('click', '.change-walls-color-button', () => {
  unityInstance.SendMessage('Walls', 'ChooseNextMat');
})

$(document).on('click', '.steps', () => {
  unityInstance.SendMessage('CameraSwitch', 'ChangeCamera', 'walk');
})

$(document).on('click', '.ddd', () => {
  unityInstance.SendMessage('CameraSwitch', 'ChangeCamera', 'orbit');
})

$(document).ready(() => {
  Object.keys(solution.data.alternatives).map(k => {
    $('.imagination-list').append(`
      <div class="shop-wrapper">
        <div class="shop shop-${k}"></div>
        <div class="shop-nav-${k} shop-nav">
            <button type="button" class="slick-next shop-nav__next shop-nav-${k}__next"></button>
            <button type="button" class="slick-prev shop-nav__prev shop-nav-${k}__next"></button>
        </div>
      </div>
    `)
    const type = solution.data.alternatives[k]
    type.map((t, i) => {
      $(`.shop-${k}`).append(`
        <div class="shop-item shop-${k}-item-${i}" data-model-url="${t.assetUrl}|${t.assetName}|${t.id}|true" data-type="${t.type}">
            <div class="shop-container">
                <div class="shop-item__img">
                    <img src="${t.image}" alt="shop-img" title="shop-img">
                </div>
                <div class="shop-item__info">
                    <h3>${t.info.join(' ')}</h3>
                    <p>${t.price},00 €</p>
                </div>
                <div class="shop-item__bucket">
                    <a href="#"><span class="icon-cart"></span></a>
                </div>
            </div>
        </div>
      `)
    })

    const prevArrow = $(`.shop-nav-${k}__next.shop-nav__prev`);
    const nextArrow = $(`.shop-nav-${k}__next.shop-nav__next`);

    const shop = $(`.shop-${k}`)

    shop.slick({
      arrows: true,
      autoplay: false,
      prevArrow,
      nextArrow,
      fade: false,
      slidesToShow: 1,
      slidesToScroll: 1,
      focusOnChange: false,
      focusOnSelect: false,
      infinite: true,
      dots: true,
    });

    shop.on('afterChange', function(event, slick, currentSlide){
      $('.webgl-content').css({ filter: 'blur(5px)' })
      const currentItem = $(`.shop-${k}-item-${currentSlide}`);
      unityInstance.SendMessage(
        currentItem.attr('data-type'),
        'Load',
        currentItem.attr('data-model-url')
      )
    });
  })

  otherFurniture.map((k, i) => {
    $('.imagination-list').append(`
      <div class="shop-wrapper">
        <div class="shop shop-${i}">
          <div class="shop-item shop-${i}-item">
            <div class="shop-container">
                <div class="shop-item__img">
                    <img src="${k.image}" alt="shop-img" title="shop-img">
                </div>
                <div class="shop-item__info">
                    <h3>${k.info.join(' ')}</h3>
                    <p>${k.price},00 €</p>
                </div>
                <div class="shop-item__bucket">
                    <a href="#"><span class="icon-cart"></span></a>
                </div>
            </div>
        </div>
        </div>
        <div class="shop-nav-${i} shop-nav">
            <button type="button" class="slick-next shop-nav__next shop-nav-${i}__next"></button>
            <button type="button" class="slick-prev shop-nav__prev shop-nav-${i}__next"></button>
        </div>
      </div>
    `)
  })
/*  unityInstance = UnityLoader.instantiate(
    'unityContainer',
    '/scenes/office/Build/office.json',
  );
  window.unityInstance = unityInstance*/
})


function loadAllModels() {
  const { alternatives } = solution.data
  Object.keys(alternatives).map(k =>
    alternatives[k].map(f =>
      unityInstance.SendMessage(
        f.type,
        'Load',
        f.assetUrl + '|' + f.assetName + '|' + f.id
      )
    )
  );
}
